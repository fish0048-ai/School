(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85],{2226:(e,t,s)=>{Promise.resolve().then(s.bind(s,5622))},4585:(e,t,s)=>{"use strict";s.d(t,{db:()=>r,j:()=>c});var a=s(2078),l=s(2553),n=s(9390);let d=(0,a.Wp)({apiKey:"AIzaSyDD_LVP9WTmEJP1ug68ajrFqQufu65X_BA",authDomain:"cish-906-school.firebaseapp.com",projectId:"cish-906-school",storageBucket:"cish-906-school.firebasestorage.app",messagingSenderId:"795413031258",appId:"1:795413031258:web:13c9916b84c07cd4dbeb63"}),c=(0,l.xI)(d),r=(0,n.aU)(d)},5622:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(5155),l=s(2115),n=s(9390),d=s(4585);function c(e){return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0"))}function r(){let[e,t]=(0,l.useState)(new Date().getFullYear()),[s,r]=(0,l.useState)(new Date().getMonth()),[i,o]=(0,l.useState)([]),[x,h]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let t=new Date(e,s,1),a=new Date(e,s+1,0),l=c(t),r=c(a);Promise.all([(0,n.GG)((0,n.rJ)(d.db,"announcements")),(0,n.GG)((0,n.rJ)(d.db,"countdown_events"))]).then(e=>{let[t,s]=e,a=[];t.docs.forEach(e=>{let t=e.data(),s=t.date||"";s>=l&&s<=r&&a.push({id:e.id,title:t.title||"",date:s,due:t.due,content:t.content,type:"announcement"})}),s.docs.forEach(e=>{let t=e.data(),s=t.date,n="";(null==s?void 0:s.toDate)?n=c(s.toDate()):"string"==typeof s&&(n=s.slice(0,10)),n&&n>=l&&n<=r&&a.push({id:e.id,title:t.title||"",date:n,type:"countdown"})}),o(a.sort((e,t)=>e.date.localeCompare(t.date)))}).catch(console.error).finally(()=>h(!1))},[e,s]);let m=a=>{let l=s+a,n=e;l<0?(l=11,n--):l>11&&(l=0,n++),r(l),t(n)},u=new Date(e,s,1).getDay(),p=new Date(e,s+1,0).getDate(),g=c(new Date),b=[];for(let e=0;e<(0===u?6:u-1);e++)b.push(null);for(let e=1;e<=p;e++)b.push(e);let f={};return i.forEach(e=>{f[e.date]||(f[e.date]=[]),f[e.date].push(e)}),(0,a.jsxs)("div",{className:"bg-white p-4 sm:p-6 rounded-2xl shadow-sm border-t-4 border-indigo-500",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-slate-800",children:[(0,a.jsx)("i",{className:"fas fa-calendar-alt text-indigo-500 mr-2"})," 重要日程"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1 rounded-lg text-sm",children:[(0,a.jsx)("button",{onClick:()=>m(-1),className:"p-2 rounded hover:bg-white",children:(0,a.jsx)("i",{className:"fas fa-chevron-left"})}),(0,a.jsxs)("span",{className:"font-bold text-slate-700 min-w-[80px] text-center",children:[e,"年 ",s+1,"月"]}),(0,a.jsx)("button",{onClick:()=>m(1),className:"p-2 rounded hover:bg-white",children:(0,a.jsx)("i",{className:"fas fa-chevron-right"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-7 gap-1 mb-2 text-center text-slate-500 text-xs font-bold",children:[(0,a.jsx)("div",{className:"text-red-500",children:"日"}),(0,a.jsx)("div",{children:"一"}),(0,a.jsx)("div",{children:"二"}),(0,a.jsx)("div",{children:"三"}),(0,a.jsx)("div",{children:"四"}),(0,a.jsx)("div",{children:"五"}),(0,a.jsx)("div",{className:"text-green-600",children:"六"})]}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 bg-slate-200 border border-slate-300 rounded-lg overflow-hidden",children:b.map((t,l)=>{let n=t?c(new Date(e,s,t)):"",d=n&&f[n]||[];return(0,a.jsxs)("div",{className:"aspect-square bg-white p-1 text-sm flex flex-col ".concat(null===t?"bg-slate-50":""," ").concat(n===g?"bg-blue-100 ring-2 ring-blue-500":""),children:[(0,a.jsx)("span",{children:null!=t?t:""}),d.length>0&&(0,a.jsxs)("span",{className:"text-xs text-indigo-600 mt-auto",children:[d.length," 項"]})]},l)})}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-indigo-50 rounded-xl border border-indigo-100",children:[(0,a.jsx)("h3",{className:"font-bold text-indigo-900 mb-3 text-sm",children:"本月日程"}),x?(0,a.jsx)("p",{className:"text-slate-500 text-sm",children:"載入中..."}):0===i.length?(0,a.jsx)("p",{className:"text-slate-500 text-sm",children:"本月尚無公告或倒數事件"}):(0,a.jsx)("ul",{className:"space-y-2",children:i.map(e=>(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-slate-500 shrink-0",children:e.date}),(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-xs ".concat("countdown"===e.type?"bg-amber-100 text-amber-800":"bg-blue-100 text-blue-800"),children:"countdown"===e.type?"倒數":"公告"}),(0,a.jsx)("span",{className:"font-medium",children:e.title})]},e.id))})]})]})}}},e=>{e.O(0,[399,563,320,441,255,358],()=>e(e.s=2226)),_N_E=e.O()}]);