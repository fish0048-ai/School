(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[262],{4269:(e,t,l)=>{"use strict";function s(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return String(e||"").replace(/[&<>"']/g,e=>{var l;return null!=(l=t[e])?l:e})}l.d(t,{ZD:()=>s})},4585:(e,t,l)=>{"use strict";l.d(t,{db:()=>d,j:()=>i});var s=l(2078),r=l(2553),a=l(9390);let n=(0,s.Wp)({apiKey:"AIzaSyDD_LVP9WTmEJP1ug68ajrFqQufu65X_BA",authDomain:"cish-906-school.firebaseapp.com",projectId:"cish-906-school",storageBucket:"cish-906-school.firebasestorage.app",messagingSenderId:"795413031258",appId:"1:795413031258:web:13c9916b84c07cd4dbeb63"}),i=(0,r.xI)(n),d=(0,a.aU)(n)},4901:(e,t,l)=>{"use strict";l.d(t,{A:()=>u,AuthProvider:()=>c});var s=l(5155),r=l(2115),a=l(2553),n=l(9390),i=l(4585);let d=(0,r.createContext)(null);function c(e){let{children:t}=e,[l,c]=(0,r.useState)(null),[u,o]=(0,r.useState)(null),[x,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=(0,a.hg)(i.j,async e=>{if(c(e),e){var t,l,s;let r=(await (0,n.x7)((0,n.H9)(i.db,"users",e.uid))).data();o({uid:e.uid,email:null!=(t=e.email)?t:null,role:null!=(l=null==r?void 0:r.role)?l:"student",displayName:null!=(s=e.displayName)?s:null==r?void 0:r.displayName})}else o(null);m(!1)});return()=>e()},[]);let f=async(e,t)=>{await (0,a.x9)(i.j,e,t)},h=async()=>{let e=new a.HF;await (0,a.df)(i.j,e)},p=async()=>{await (0,a.CI)(i.j),o(null)};return(0,s.jsx)(d.Provider,{value:{user:l,profile:u,loading:x,signIn:f,signInWithGoogle:h,signOut:p,hasRole:function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];return!!u&&t.includes(u.role)}},children:t})}function u(){let e=(0,r.useContext)(d);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6875:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>c});var s=l(5155),r=l(2115),a=l(9390),n=l(4585),i=l(4901),d=l(4269);function c(){var e,t,l;let{hasRole:c,profile:u}=(0,i.A)(),[o,x]=(0,r.useState)(null),[m,f]=(0,r.useState)(!0);if((0,r.useEffect)(()=>{if(!c("teacher","staff"))return void f(!1);(0,a.GG)((0,a.rJ)(n.db,"seating")).then(e=>{x(e.docs.map(e=>({id:e.id,...e.data()}))[0]||null)}).catch(console.error).finally(()=>f(!1))},[c,u]),!c("teacher","staff"))return(0,s.jsxs)("div",{className:"bg-white p-4 sm:p-6 rounded-2xl shadow-sm border-t-4 border-green-500",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:[(0,s.jsx)("i",{className:"fas fa-border-all text-green-500 mr-2"})," 座位表"]}),(0,s.jsxs)("div",{className:"bg-green-50 p-6 rounded-xl border border-green-100 text-center",children:[(0,s.jsx)("i",{className:"fas fa-lock text-2xl text-green-600 mb-3"}),(0,s.jsx)("h3",{className:"font-bold text-slate-800 mb-3",children:"請登入後查看"}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"座位表需具備 teacher 或 staff 權限"})]})]});if(m)return(0,s.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,s.jsx)("i",{className:"fas fa-circle-notch fa-spin text-4xl text-green-500"})});let h=null==o?void 0:o.grid,p=null!=(t=null==o?void 0:o.rows)?t:(null==h?void 0:h.length)||8,b=null!=(l=null==o?void 0:o.cols)?l:(null==h||null==(e=h[0])?void 0:e.length)||6;return(0,s.jsxs)("div",{className:"bg-white p-4 sm:p-6 rounded-2xl shadow-sm border-t-4 border-green-500",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:[(0,s.jsx)("i",{className:"fas fa-border-all text-green-500 mr-2"})," 座位表"]}),h||(null==o?void 0:o.cells)?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsx)("div",{className:"inline-grid gap-1 p-4 bg-slate-50 rounded-xl",style:{gridTemplateColumns:"repeat(".concat(b,", minmax(80px, 1fr))"),gridTemplateRows:"repeat(".concat(p,", minmax(40px, 1fr))")},children:null==h?void 0:h.flat().map((e,t)=>(0,s.jsx)("div",{className:"flex items-center justify-center p-2 bg-white border border-slate-200 rounded text-sm font-medium",children:(0,d.ZD)(String(e||""))},t))})}):(0,s.jsxs)("p",{className:"text-slate-500 py-8",children:["尚無座位表資料。請執行遷移腳本匯入，或於 Firestore ",(0,s.jsx)("code",{children:"seating"})," 集合新增文件，格式為"," ",(0,s.jsx)("code",{children:"grid: [[座號1, 姓名1], ...]"})]})]})}},8937:(e,t,l)=>{Promise.resolve().then(l.bind(l,6875))}},e=>{e.O(0,[399,563,320,441,255,358],()=>e(e.s=8937)),_N_E=e.O()}]);