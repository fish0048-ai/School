(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[915],{3320:(e,t,s)=>{Promise.resolve().then(s.bind(s,9664))},4269:(e,t,s)=>{"use strict";function l(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return String(e||"").replace(/[&<>"']/g,e=>{var s;return null!=(s=t[e])?s:e})}s.d(t,{ZD:()=>l})},4585:(e,t,s)=>{"use strict";s.d(t,{db:()=>n,j:()=>c});var l=s(2078),a=s(2553),r=s(9390);let d=(0,l.Wp)({apiKey:"AIzaSyDD_LVP9WTmEJP1ug68ajrFqQufu65X_BA",authDomain:"cish-906-school.firebaseapp.com",projectId:"cish-906-school",storageBucket:"cish-906-school.firebasestorage.app",messagingSenderId:"795413031258",appId:"1:795413031258:web:13c9916b84c07cd4dbeb63"}),c=(0,a.xI)(d),n=(0,r.aU)(d)},4901:(e,t,s)=>{"use strict";s.d(t,{A:()=>x,AuthProvider:()=>i});var l=s(5155),a=s(2115),r=s(2553),d=s(9390),c=s(4585);let n=(0,a.createContext)(null);function i(e){let{children:t}=e,[s,i]=(0,a.useState)(null),[x,o]=(0,a.useState)(null),[m,h]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=(0,r.hg)(c.j,async e=>{if(i(e),e){var t,s,l;let a=(await (0,d.x7)((0,d.H9)(c.db,"users",e.uid))).data();o({uid:e.uid,email:null!=(t=e.email)?t:null,role:null!=(s=null==a?void 0:a.role)?s:"student",displayName:null!=(l=e.displayName)?l:null==a?void 0:a.displayName})}else o(null);h(!1)});return()=>e()},[]);let u=async(e,t)=>{await (0,r.x9)(c.j,e,t)},p=async()=>{let e=new r.HF;await (0,r.df)(c.j,e)},f=async()=>{await (0,r.CI)(c.j),o(null)};return(0,l.jsx)(n.Provider,{value:{user:s,profile:x,loading:m,signIn:u,signInWithGoogle:p,signOut:f,hasRole:function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return!!x&&t.includes(x.role)}},children:t})}function x(){let e=(0,a.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9664:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var l=s(5155),a=s(2115),r=s(9390),d=s(4585),c=s(4901),n=s(4269);function i(){let{hasRole:e,profile:t}=(0,c.A)(),[s,i]=(0,a.useState)([]),[x,o]=(0,a.useState)(!0);if((0,a.useEffect)(()=>{if(!e("teacher","staff"))return void o(!1);(0,r.GG)((0,r.P)((0,r.rJ)(d.db,"class_fund"),(0,r.My)("date","asc"))).then(e=>{i(e.docs.map(e=>({id:e.id,...e.data()})))}).catch(console.error).finally(()=>o(!1))},[e,t]),!e("teacher","staff"))return(0,l.jsxs)("div",{className:"bg-white p-4 sm:p-6 rounded-2xl shadow-sm border-t-4 border-emerald-500",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:[(0,l.jsx)("i",{className:"fas fa-coins text-emerald-500 mr-2"})," 班費收支"]}),(0,l.jsxs)("div",{className:"bg-emerald-50 p-6 rounded-xl border border-emerald-100 text-center",children:[(0,l.jsx)("i",{className:"fas fa-lock text-2xl text-emerald-600 mb-3"}),(0,l.jsx)("h3",{className:"font-bold text-slate-800 mb-3",children:"請登入後查看"}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"班費功能需具備 teacher 或 staff 權限"})]})]});if(x)return(0,l.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,l.jsx)("i",{className:"fas fa-circle-notch fa-spin text-4xl text-emerald-500"})});let m=s.reduce((e,t)=>e+(Number(t.income)||0),0),h=s.reduce((e,t)=>e+(Number(t.expense)||0),0);return(0,l.jsxs)("div",{className:"bg-white p-4 sm:p-6 rounded-2xl shadow-sm border-t-4 border-emerald-500",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:[(0,l.jsx)("i",{className:"fas fa-coins text-emerald-500 mr-2"})," 班費收支"]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,l.jsxs)("div",{className:"p-4 bg-green-50 rounded-xl border border-green-200",children:[(0,l.jsx)("p",{className:"text-sm text-green-700",children:"收入總計"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-green-800",children:["$",m]})]}),(0,l.jsxs)("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[(0,l.jsx)("p",{className:"text-sm text-red-700",children:"支出總計"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-red-800",children:["$",h]})]}),(0,l.jsxs)("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[(0,l.jsx)("p",{className:"text-sm text-emerald-700",children:"結餘"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-emerald-800",children:["$",m-h]})]})]}),(0,l.jsx)("div",{className:"overflow-x-auto rounded-lg border border-slate-200",children:(0,l.jsxs)("table",{className:"min-w-full text-sm",children:[(0,l.jsx)("thead",{className:"bg-slate-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-3 text-left font-bold text-slate-500",children:"日期"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left font-bold text-slate-500",children:"項目"}),(0,l.jsx)("th",{className:"px-4 py-3 text-right font-bold text-slate-500",children:"收入"}),(0,l.jsx)("th",{className:"px-4 py-3 text-right font-bold text-slate-500",children:"支出"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left font-bold text-slate-500",children:"備註"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-slate-200",children:0===s.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:5,className:"p-8 text-center text-slate-500",children:"尚無班費紀錄"})}):s.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-emerald-50",children:[(0,l.jsx)("td",{className:"px-4 py-3",children:(0,n.ZD)(e.date)}),(0,l.jsx)("td",{className:"px-4 py-3 font-medium",children:(0,n.ZD)(e.item)}),(0,l.jsx)("td",{className:"px-4 py-3 text-right text-green-600",children:Number(e.income)?"$".concat(e.income):"-"}),(0,l.jsx)("td",{className:"px-4 py-3 text-right text-red-600",children:Number(e.expense)?"$".concat(e.expense):"-"}),(0,l.jsx)("td",{className:"px-4 py-3 text-slate-500",children:(0,n.ZD)(e.note)})]},e.id))})]})})]})}}},e=>{e.O(0,[399,563,320,441,255,358],()=>e(e.s=3320)),_N_E=e.O()}]);